name: build

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        buildtype: [release, debug]

    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Add LunarG Vulkan SDK repository
        run: |
          wget -qO- https://packages.lunarg.com/lunarg-signing-key-pub.asc | sudo tee /etc/apt/trusted.gpg.d/lunarg.asc
          sudo wget -qO /etc/apt/sources.list.d/lunarg-vulkan-noble.list https://packages.lunarg.com/vulkan/lunarg-vulkan-noble.list
          sudo apt-get update

      - name: Install dependencies
        run: |
          sudo apt-get install -y \
            gcc \
            ninja-build \
            libvulkan-dev \
            vulkan-headers \
            shaderc \
            libassimp-dev \
            libcglm-dev \
            libsixel-dev \
            meson \
            libvips-dev

      - name: Configure
        run: meson setup build --buildtype=${{ matrix.buildtype }} -Duse_sanitizers=false

      - name: Build
        run: meson compile -C build
